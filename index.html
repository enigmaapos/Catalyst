<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Catalyst DApp v7</title>
  <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.min.js"></script>
  <style>
    body { font-family: Arial, sans-serif; background: #0a0a0a; color: #f0f0f0; margin: 0; padding: 20px; }
    h1, h2, h3 { color: #ffcc00; }
    .card { background: #1a1a1a; padding: 16px; border-radius: 12px; margin-bottom: 20px; box-shadow: 0 0 8px rgba(0,0,0,0.6); }
    button { background: #ffcc00; border: none; padding: 8px 14px; border-radius: 8px; cursor: pointer; font-weight: bold; }
    button:hover { background: #ffdb4d; }
    input, select { padding: 6px; margin: 4px 0; border-radius: 6px; border: 1px solid #333; background: #111; color: #fff; }
    table { border-collapse: collapse; margin-top: 10px; }
    table, th, td { border: 1px solid #444; }
    th, td { padding: 6px 10px; font-size: 13px; }
    .muted { color: #aaa; }
    .small { font-size: 13px; }
    .row { display: flex; gap: 20px; }
    .col { flex: 1; }
    #log { white-space: pre-line; font-size: 12px; margin-top: 10px; background: #111; padding: 8px; border-radius: 6px; }
  </style>
</head>
<body>
  <h1>‚ö° Catalyst DApp v7</h1>

  <!-- Wallet Connect -->
  <div class="card">
    <h2>Wallet</h2>
    <button onclick="connectWallet()">Connect Wallet</button>
    <div id="walletAddress" class="muted"></div>
  </div>

  <!-- Register Collection -->
  <div class="card">
    <h2>Register Collection</h2>
    <input id="collectionAddress" placeholder="Collection Address (ERC721)" size="50" />
    <input id="declaredSupply" type="number" placeholder="Declared Supply" />
    <label><input type="checkbox" id="verifiedBox" /> Verified?</label><br/>
    <button onclick="registerCollection()">Register</button>
    <div id="registerLog" class="muted small"></div>
  </div>

  <!-- Stake / Unstake -->
  <div class="card">
    <h2>Stake / Unstake</h2>
    <input id="stakeCollection" placeholder="Collection Address" size="50" />
    <input id="tokenId" placeholder="Token ID" />
    <button onclick="termStake()">Term Stake</button>
    <button onclick="permanentStake()">Permanent Stake</button>
    <button onclick="unstake()">Unstake</button>
    <div id="stakeLog" class="muted small"></div>
  </div>

  <!-- Harvest -->
  <div class="card">
    <h2>Harvest Rewards</h2>
    <input id="harvestCollection" placeholder="Collection Address" size="50" />
    <input id="harvestTokenId" placeholder="Token ID" />
    <button onclick="harvest()">Harvest</button>
    <div id="harvestLog" class="muted small"></div>
  </div>

  <!-- Burner Bonus Eligibility -->
  <div class="card">
    <h2>Burner Bonus Eligibility</h2>
    <div class="muted small">Check if your wallet qualifies for the next Top 1% burner bonus.</div>
    <button onclick="checkEligibility()">Check My Eligibility</button>
    <div id="eligibilityLog" class="muted small"></div>
  </div>

  <!-- Placeholder Leaderboards -->
  <div class="card">
    <h2>Leaderboards (Placeholder)</h2>
    <div class="row">
      <div class="col">
        <h3 class="small">üî• Top Burners</h3>
        <table width="100%">
          <tr><th>Wallet</th><th>Burned CATA</th></tr>
          <tr><td>0x123...abc</td><td>120,000</td></tr>
          <tr><td>0x456...def</td><td>95,500</td></tr>
          <tr><td>0x789...ghi</td><td>80,200</td></tr>
        </table>
      </div>
      <div class="col">
        <h3 class="small">üì¶ Top Collections</h3>
        <table width="100%">
          <tr><th>Collection</th><th>Burned CATA</th></tr>
          <tr><td>BAYC</td><td>500,000</td></tr>
          <tr><td>Azuki</td><td>320,000</td></tr>
          <tr><td>CloneX</td><td>210,000</td></tr>
        </table>
      </div>
    </div>
  </div>

  <!-- Debug Log -->
  <div id="log"></div>

  <script>
    let provider, signer, contract;
    const CONTRACT_ADDRESS = "PASTE_DEPLOYED_CONTRACT_HERE";
    const ABI = [ /* ABI JSON from final Catalyst contract */ ];

    function log(...args) {
      console.log(...args);
      document.getElementById("log").textContent += args.join(" ") + "\\n";
    }

    async function connectWallet() {
      provider = new ethers.providers.Web3Provider(window.ethereum);
      await provider.send("eth_requestAccounts", []);
      signer = provider.getSigner();
      document.getElementById("walletAddress").textContent = await signer.getAddress();
      contract = new ethers.Contract(CONTRACT_ADDRESS, ABI, signer);
      log("Wallet connected");
    }

    async function registerCollection() {
      try {
        const coll = document.getElementById("collectionAddress").value;
        const supply = document.getElementById("declaredSupply").value;
        const verified = document.getElementById("verifiedBox").checked;
        const tx = await contract.registerCollection(coll, supply, verified);
        await tx.wait();
        document.getElementById("registerLog").textContent = "Registered " + coll;
        log("Registered collection", coll);
      } catch (e) { log("register err", e); }
    }

    async function termStake() {
      try {
        const coll = document.getElementById("stakeCollection").value;
        const tokenId = document.getElementById("tokenId").value;
        const tx = await contract.termStake(coll, tokenId);
        await tx.wait();
        document.getElementById("stakeLog").textContent = "Staked term NFT " + tokenId;
      } catch (e) { log("stake err", e); }
    }

    async function permanentStake() {
      try {
        const coll = document.getElementById("stakeCollection").value;
        const tokenId = document.getElementById("tokenId").value;
        const tx = await contract.permanentStake(coll, tokenId);
        await tx.wait();
        document.getElementById("stakeLog").textContent = "Staked permanent NFT " + tokenId;
      } catch (e) { log("perm stake err", e); }
    }

    async function unstake() {
      try {
        const coll = document.getElementById("stakeCollection").value;
        const tokenId = document.getElementById("tokenId").value;
        const tx = await contract.unstake(coll, tokenId);
        await tx.wait();
        document.getElementById("stakeLog").textContent = "Unstaked NFT " + tokenId;
      } catch (e) { log("unstake err", e); }
    }

    async function harvest() {
      try {
        const coll = document.getElementById("harvestCollection").value;
        const tokenId = document.getElementById("harvestTokenId").value;
        const tx = await contract.harvestBatch(coll, [tokenId]);
        await tx.wait();
        document.getElementById("harvestLog").textContent = "Harvested token " + tokenId;
      } catch (e) { log("harvest err", e); }
    }

    async function checkEligibility() {
      try {
        if (!contract || !signer) return alert("Connect wallet first");
        const user = await signer.getAddress();

        const burned = await contract.burnedCatalystByAddress(user);
        const minBurn = await contract.minBurnToQualifyBonus();
        const minStaked = await contract.minStakedToQualifyBonus();

        const collections = await contract.getRegisteredCollections();
        let totalStaked = 0;
        for (const coll of collections) {
          const tokens = await contract.getUserStakedTokens(coll, user);
          totalStaked += tokens.length;
        }

        let msg = `Burned: ${burned} | Staked: ${totalStaked}\\n`;
        if (burned.gte(minBurn) && totalStaked >= minStaked) {
          msg += "‚úÖ Eligible for Burner Bonus!";
        } else {
          msg += "‚ùå Not eligible.\\n";
          if (burned.lt(minBurn)) msg += `- Need more burns (min ${minBurn})\\n`;
          if (totalStaked < minStaked) msg += `- Need more staked NFTs (min ${minStaked})\\n`;
        }

        document.getElementById("eligibilityLog").textContent = msg;
        log("Eligibility checked", msg);
      } catch (e) {
        log("eligibility err", String(e));
      }
    }
  </script>
</body>
</html>
