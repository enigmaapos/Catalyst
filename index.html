<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Catalyst NFT Staking Protocol</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script src="https://cdn.jsdelivr.net/npm/web3@1.6.1/dist/web3.min.js"></script>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    h1 { color: #3f51b5; }
    button { margin: 5px; padding: 10px; }
    input { margin: 5px; padding: 8px; }
    .section { margin-bottom: 20px; }
    .card { border: 1px solid #ccc; border-radius: 8px; padding: 15px; margin-bottom: 15px; }
  </style>
</head>
<body>
  <h1>üî• Catalyst NFT Staking Protocol</h1>
  <p>Stake your NFTs, earn $CATA rewards, and contribute to the Catalyst ecosystem!</p>

  <div class="section card">
    <h2>Wallet</h2>
    <button onclick="connectWallet()">Connect Wallet</button>
    <p id="walletAddress">Not connected</p>
    <p>Your $CATA Balance: <span id="cataBalance">0</span></p>
  </div>

  <div class="section card">
    <h2>Collections</h2>
    <input type="text" id="collectionAddress" placeholder="NFT Collection Address" size="50">
    <button onclick="registerCollection()">Register Collection</button>
    <p id="registerStatus"></p>
  </div>

  <div class="section card">
    <h2>Staking</h2>
    <input type="text" id="stakeCollection" placeholder="Collection Address" size="50">
    <input type="number" id="tokenId" placeholder="Token ID">
    <button onclick="termStake()">Term Stake NFT</button>
    <button onclick="permanentStake()">Permanent Stake NFT</button>
    <p id="stakeStatus"></p>
  </div>

  <div class="section card">
    <h2>Unstaking</h2>
    <input type="text" id="unstakeCollection" placeholder="Collection Address" size="50">
    <input type="number" id="unstakeTokenId" placeholder="Token ID">
    <button onclick="unstake()">Unstake NFT</button>
    <p id="unstakeStatus"></p>
  </div>

  <div class="section card">
    <h2>Harvest Rewards</h2>
    <input type="text" id="harvestCollection" placeholder="Collection Address" size="50">
    <button onclick="harvestAll()">Harvest All Rewards</button>
    <p id="harvestStatus"></p>
  </div>

  <div class="section card">
    <h2>Governance</h2>
    <input type="text" id="govCollection" placeholder="Collection Address" size="50">
    <input type="number" id="newRate" placeholder="New Base Reward Rate">
    <button onclick="proposeAndVote()">Propose & Vote</button>
    <p id="govStatus"></p>
  </div>

  <script>
    let web3;
    let accounts;

    // Replace with deployed contract addresses
    const CATA_CONTRACT_ADDRESS = "YOUR_CATA_CONTRACT_ADDRESS";
    const CATA_ABI = []; // paste ABI here

    let cataContract;

    async function connectWallet() {
      if (window.ethereum) {
        web3 = new Web3(window.ethereum);
        accounts = await ethereum.request({ method: 'eth_requestAccounts' });
        document.getElementById("walletAddress").innerText = accounts[0];
        cataContract = new web3.eth.Contract(CATA_ABI, CATA_CONTRACT_ADDRESS);
        updateBalance();
      } else {
        alert("Please install MetaMask!");
      }
    }

    async function updateBalance() {
      if (!cataContract || !accounts) return;
      const balance = await cataContract.methods.balanceOf(accounts[0]).call();
      document.getElementById("cataBalance").innerText = web3.utils.fromWei(balance, "ether");
    }

    async function registerCollection() {
      const addr = document.getElementById("collectionAddress").value;
      try {
        await cataContract.methods.setCollectionConfig(addr).send({ from: accounts[0] });
        document.getElementById("registerStatus").innerText = "‚úÖ Collection registered!";
      } catch (e) {
        document.getElementById("registerStatus").innerText = "‚ùå " + e.message;
      }
    }

    async function termStake() {
      const addr = document.getElementById("stakeCollection").value;
      const tokenId = document.getElementById("tokenId").value;
      try {
        await cataContract.methods.termStake(addr, tokenId).send({ from: accounts[0] });
        document.getElementById("stakeStatus").innerText = "‚úÖ Term staked!";
      } catch (e) {
        document.getElementById("stakeStatus").innerText = "‚ùå " + e.message;
      }
    }

    async function permanentStake() {
      const addr = document.getElementById("stakeCollection").value;
      const tokenId = document.getElementById("tokenId").value;
      try {
        await cataContract.methods.permanentStake(addr, tokenId).send({ from: accounts[0] });
        document.getElementById("stakeStatus").innerText = "‚úÖ Permanently staked!";
      } catch (e) {
        document.getElementById("stakeStatus").innerText = "‚ùå " + e.message;
      }
    }

    async function unstake() {
      const addr = document.getElementById("unstakeCollection").value;
      const tokenId = document.getElementById("unstakeTokenId").value;
      try {
        await cataContract.methods.unstake(addr, tokenId).send({ from: accounts[0] });
        document.getElementById("unstakeStatus").innerText = "‚úÖ Unstaked!";
      } catch (e) {
        document.getElementById("unstakeStatus").innerText = "‚ùå " + e.message;
      }
    }

    async function harvestAll() {
      const addr = document.getElementById("harvestCollection").value;
      try {
        await cataContract.methods.harvestAll(addr).send({ from: accounts[0] });
        document.getElementById("harvestStatus").innerText = "‚úÖ Rewards harvested!";
        updateBalance();
      } catch (e) {
        document.getElementById("harvestStatus").innerText = "‚ùå " + e.message;
      }
    }

    async function proposeAndVote() {
      const addr = document.getElementById("govCollection").value;
      const newRate = document.getElementById("newRate").value;
      try {
        await cataContract.methods.proposeAndVote(newRate, addr).send({ from: accounts[0] });
        document.getElementById("govStatus").innerText = "‚úÖ Voted!";
      } catch (e) {
        document.getElementById("govStatus").innerText = "‚ùå " + e.message;
      }
    }
  </script>
</body>
</html>
