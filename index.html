<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Catalyst DApp – v1 upgraded (dual contract)</title>
  <script src="https://cdn.jsdelivr.net/npm/ethers@6.13.2/dist/ethers.umd.min.js"></script>
  <style>
    body { font-family: Arial, sans-serif; background:#0f1220; color:#e7ecf4; margin:0; }
    header { padding:12px 20px; background:#171a2b; display:flex; gap:12px; align-items:center; }
    button { padding:8px 12px; border:none; border-radius:6px; cursor:pointer; }
    button.primary { background:#132a39; color:#fff; }
    .tabbar button { margin-right:6px; }
    .tab { display:none; margin:20px; }
    .tab.active { display:block; }
    .log { background:#171a2b; padding:10px; margin:20px; border-radius:6px; font-family:monospace; white-space:pre-wrap; font-size:13px; }
  </style>
</head>
<body>
  <header>
    <h2>⚗️ Catalyst DApp</h2>
    <input id="contractAddress" placeholder="0x... contract" style="flex:1; padding:6px;" />
    <button class="primary" id="saveContractBtn">Save</button>
    <button class="primary" id="connectBtn">Connect Wallet</button>
    <span id="acct">Not connected</span>
  </header>

  <div class="tabbar" style="margin:20px;">
    <button data-tab="stake" class="primary">Stake</button>
    <button data-tab="bluechip">Blue-Chip</button>
    <button data-tab="governance">Governance</button>
    <button data-tab="guardians">Guardians</button>
    <button data-tab="admin">Admin</button>
  </div>

  <div id="tab-stake" class="tab active">
    <h3>Stake</h3>
    <input id="colStake" placeholder="Collection" />
    <input id="tidStake" type="number" placeholder="Token ID" />
    <button id="btnStake" class="primary">Stake</button>
    <button id="btnUnstake">Unstake</button>
    <button id="btnHarvest">Harvest</button>
  </div>

  <div id="tab-bluechip" class="tab">
    <h3>Blue-Chip</h3>
    <button id="btnEnrollBlue" class="primary">Enroll Blue-Chip</button>
    <input id="colBlueHarvest" placeholder="Collection" />
    <button id="btnHarvestBlue">Harvest Blue-Chip</button>
  </div>

  <div id="tab-governance" class="tab">
    <h3>Governance</h3>
    <input id="propId" placeholder="Proposal ID" />
    <button id="btnVote">Vote</button>
    <button id="btnExecute">Execute</button>
  </div>

  <div id="tab-guardians" class="tab">
    <h3>Guardians</h3>
    <input id="newDeployer" placeholder="New Deployer" />
    <button id="btnPropDep">Propose</button>
    <button id="btnApproveDep">Approve</button>
    <button id="btnExecDep">Execute</button>
  </div>

  <div id="tab-admin" class="tab">
    <h3>Admin</h3>
    <button id="btnPause">Pause</button>
    <button id="btnUnpause">Unpause</button>
  </div>

  <div class="log" id="log">Console log...</div>

<script>
const ABI = [
  "function stakingStats() view returns (uint256 totalAll,uint256 totalTerm,uint256 totalPermanent,uint256 remainingGlobal,uint256 remainingTerm,uint256 remainingPermanent)",
  "function stake(address collection,uint256 tokenId,bool permanent)",
  "function unstake(address collection,uint256 tokenId)",
  "function harvest(address collection,uint256 tokenId)",
  "function enrollBluechip()",
  "function harvestBluechip(address collection)",
  "function vote(bytes32 id)",
  "function executeProposal(bytes32 id)",
  "function proposeDeployerRecovery(address newDeployer)",
  "function approveDeployerRecovery()",
  "function executeDeployerRecovery()",
  "function pause()",
  "function unpause()"
];

let provider, signer, user, contractRead, contractWrite;

function log(msg) {
  document.getElementById("log").textContent += `\n${new Date().toLocaleTimeString()} ${msg}`;
}

async function connect() {
  if (!window.ethereum) return log("No wallet found");
  provider = new ethers.BrowserProvider(window.ethereum);
  await provider.send("eth_requestAccounts", []);
  signer = await provider.getSigner();
  user = await signer.getAddress();
  document.getElementById("acct").textContent = user;

  const addr = document.getElementById("contractAddress").value;
  contractRead  = new ethers.Contract(addr, ABI, provider);
  contractWrite = new ethers.Contract(addr, ABI, signer);

  log("Connected " + user);
}

// Tabs
document.querySelectorAll(".tabbar button").forEach(btn=>{
  btn.addEventListener("click",()=>{
    document.querySelectorAll(".tab").forEach(tab=>tab.classList.remove("active"));
    document.getElementById("tab-"+btn.dataset.tab).classList.add("active");
  });
});

// ---- Stake
document.getElementById("btnStake").onclick = async ()=>{
  const col = document.getElementById("colStake").value;
  const id  = BigInt(document.getElementById("tidStake").value);
  const tx = await contractWrite.stake(col,id,true);
  await tx.wait(); log("Staked!");
};
document.getElementById("btnUnstake").onclick = async ()=>{
  const col = document.getElementById("colStake").value;
  const id  = BigInt(document.getElementById("tidStake").value);
  const tx = await contractWrite.unstake(col,id);
  await tx.wait(); log("Unstaked!");
};
document.getElementById("btnHarvest").onclick = async ()=>{
  const col = document.getElementById("colStake").value;
  const id  = BigInt(document.getElementById("tidStake").value);
  const tx = await contractWrite.harvest(col,id);
  await tx.wait(); log("Harvested!");
};

// ---- Bluechip
document.getElementById("btnEnrollBlue").onclick = async ()=>{
  const tx = await contractWrite.enrollBluechip();
  await tx.wait(); log("Bluechip Enrolled!");
};
document.getElementById("btnHarvestBlue").onclick = async ()=>{
  const col = document.getElementById("colBlueHarvest").value;
  const tx = await contractWrite.harvestBluechip(col);
  await tx.wait(); log("Bluechip Harvested!");
};

// ---- Governance
document.getElementById("btnVote").onclick = async ()=>{
  const id = document.getElementById("propId").value;
  const tx = await contractWrite.vote(id);
  await tx.wait(); log("Voted!");
};
document.getElementById("btnExecute").onclick = async ()=>{
  const id = document.getElementById("propId").value;
  const tx = await contractWrite.executeProposal(id);
  await tx.wait(); log("Executed Proposal!");
};

// ---- Guardians
document.getElementById("btnPropDep").onclick = async ()=>{
  const newDep = document.getElementById("newDeployer").value;
  const tx = await contractWrite.proposeDeployerRecovery(newDep);
  await tx.wait(); log("Proposed New Deployer!");
};
document.getElementById("btnApproveDep").onclick = async ()=>{
  const tx = await contractWrite.approveDeployerRecovery();
  await tx.wait(); log("Approved!");
};
document.getElementById("btnExecDep").onclick = async ()=>{
  const tx = await contractWrite.executeDeployerRecovery();
  await tx.wait(); log("Executed Recovery!");
};

// ---- Admin
document.getElementById("btnPause").onclick = async ()=>{
  const tx = await contractWrite.pause();
  await tx.wait(); log("Paused!");
};
document.getElementById("btnUnpause").onclick = async ()=>{
  const tx = await contractWrite.unpause();
  await tx.wait(); log("Unpaused!");
};

// Connect button
document.getElementById("connectBtn").onclick = connect;
</script>
</body>
</html>
