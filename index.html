<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Catalyst DApp v1 ‚Äì Upgraded</title>
<script src="https://cdn.jsdelivr.net/npm/ethers@6.13.2/dist/ethers.umd.min.js"></script>
<style>
  :root { --bg:#0f1220; --card:#171a2b; --muted:#9aa3b2; --text:#e7ecf4; --acc:#6ee7ff; }
  * { box-sizing:border-box; }
  body { margin:0; font-family:system-ui, -apple-system, Segoe UI, Roboto, Inter, Arial; background:var(--bg); color:var(--text); }
  header { padding:16px 20px; border-bottom:1px solid #20243a; display:flex; gap:12px; align-items:center; flex-wrap:wrap; }
  header h1 { font-size:18px; margin:0; opacity:.95; }
  .pill { background:var(--card); padding:8px 10px; border-radius:10px; border:1px solid #232744; display:flex; gap:8px; align-items:center; }
  input, select, button, textarea { background:#0c0f1c; color:var(--text); border:1px solid #27304a; border-radius:10px; padding:10px 12px; outline:none; }
  button { cursor:pointer; font-weight:600; }
  button.primary { background:#132a39; border-color:#1e3a53; }
  button:disabled { opacity:.6; cursor:not-allowed; }
  main { max-width:1100px; margin:20px auto; padding:0 16px 60px; }
  .grid { display:grid; gap:16px; grid-template-columns:repeat(12,1fr); }
  .card { grid-column:span 12; background:var(--card); border:1px solid #232744; border-radius:16px; padding:16px; }
  @media(min-width:900px){ .span6 { grid-column:span 6; } }
  .tabbar { display:flex; gap:6px; flex-wrap:wrap; margin-bottom:10px; }
  .tabbar button.active { background:#132a39; border-color:#1e3a53; }
  .row { display:grid; gap:10px; grid-template-columns:1fr 1fr; }
  .hr { height:1px; background:#232744; margin:14px 0; }
  .muted { color:var(--muted); }
  .mono { font-family: ui-monospace, monospace; }
</style>
</head>
<body>
<header>
  <h1>‚öóÔ∏è Catalyst DApp</h1>
  <div class="pill" style="gap:6px">
    <span class="muted">Contract</span>
    <input id="contractAddress" placeholder="0x‚Ä¶" style="min-width:300px">
    <button class="primary" id="saveContractBtn">Save</button>
  </div>
  <div class="pill">
    <span id="acct" class="mono muted">Not connected</span>
    <button id="connectBtn" class="primary">Connect Wallet</button>
  </div>
</header>

<main>
  <div class="grid">
    <section class="card span6">
      <div class="tabbar">
        <button data-tab="stake" class="active">Stake</button>
        <button data-tab="bluechip">Blue-Chip</button>
        <button data-tab="governance">Governance</button>
        <button data-tab="guardians">Guardians</button>
        <button data-tab="admin">Admin</button>
      </div>

      <!-- Tabs go here -->
      <div id="tab-stake" class="tab" style="display:block">
        <p>‚úÖ Stake, harvest, unstake, and register collections</p>
        <button id="btnStake">Stake</button>
        <button id="btnHarvest">Harvest</button>
        <button id="btnUnstake">Unstake</button>
        <button id="btnRegister">Register Collection</button>
      </div>

      <div id="tab-bluechip" class="tab" style="display:none">
        <p>üåê Enroll & harvest blue-chip collections</p>
        <button id="btnEnrollBlue">Enroll Blue-Chip</button>
        <button id="btnHarvestBlue">Harvest Blue-Chip</button>
        <button id="btnSetBlue">Set Blue-Chip (Admin)</button>
      </div>

      <div id="tab-governance" class="tab" style="display:none">
        <p>üìú Propose, vote, execute governance</p>
        <button id="btnPropose">Propose</button>
        <button id="btnVote">Vote</button>
        <button id="btnExecute">Execute</button>
      </div>

      <div id="tab-guardians" class="tab" style="display:none">
        <p>üõ°Ô∏è Manage Guardian recovery</p>
        <button id="btnPropDep">Propose Deployer Recovery</button>
        <button id="btnApproveDep">Approve Deployer</button>
        <button id="btnExecDep">Execute Deployer</button>
        <button id="btnPropAdm">Propose Admin Recovery</button>
        <button id="btnApproveAdm">Approve Admin</button>
        <button id="btnExecAdm">Execute Admin</button>
      </div>

      <div id="tab-admin" class="tab" style="display:none">
        <p>‚öôÔ∏è Pause, unpause, and withdraw treasury</p>
        <button id="btnPause">Pause</button>
        <button id="btnUnpause">Unpause</button>
        <button id="btnWithdraw">Withdraw Treasury</button>
      </div>
    </section>

    <section class="card span6">
      <h3>Protocol Stats</h3>
      <button id="btnRefresh" class="primary">Refresh</button>
      <div id="stats" class="mono muted">‚Äî</div>
      <div class="hr"></div>
      <h3>Console</h3>
      <div id="log" class="mono" style="font-size:12px; white-space:pre-wrap; min-height:180px"></div>
    </section>
  </div>
</main>

<script>
/*** ---- CONFIG ---- ***/
const DEFAULT_CONTRACT = "";
import ABI from "../abi/CatalystNFTStakingUpgradeable.json" assert { type: "json" };
let provider, signer, user, contract;

const $ = id => document.getElementById(id);
const log = (msg, cls="") => { $("log").prepend(`[${new Date().toLocaleTimeString()}] ${msg}\n`); };

async function initContract() {
  const addr = $("contractAddress").value.trim();
  if (!addr) throw new Error("No contract address");
  if (!signer) throw new Error("Wallet not connected");
  contract = new ethers.Contract(addr, ABI, signer);
  return contract;
}

async function connect() {
  provider = new ethers.BrowserProvider(window.ethereum);
  await provider.send("eth_requestAccounts", []);
  signer = await provider.getSigner();
  user = await signer.getAddress();
  $("acct").textContent = user;
  log(`Connected as ${user}`, "ok");
  $("contractAddress").value = localStorage.getItem("catalyst_contract") || DEFAULT_CONTRACT;
}

/*** ---- UI EVENTS ---- ***/
$("connectBtn").onclick = async ()=>{ try{ await connect(); }catch(e){ log(e.message,"err"); } };
$("saveContractBtn").onclick = ()=> localStorage.setItem("catalyst_contract", $("contractAddress").value.trim());

document.querySelectorAll(".tabbar button").forEach(btn=>{
  btn.onclick = () => {
    document.querySelectorAll(".tabbar button").forEach(b=>b.classList.remove("active"));
    btn.classList.add("active");
    const key = btn.dataset.tab;
    document.querySelectorAll(".tab").forEach(t=>t.style.display="none");
    $("tab-"+key).style.display="block";
  };
});

/*** ---- HOOK UP BUTTONS ---- ***/
// Stake
$("btnStake").onclick = async ()=>{ try{ await initContract(); let tx=await contract.stake("0x...",1,false); log(`Stake: ${tx.hash}`);}catch(e){ log(e.message,"err"); } };
$("btnHarvest").onclick = async ()=>{ try{ await initContract(); let tx=await contract.harvest("0x...",1); log(`Harvest: ${tx.hash}`);}catch(e){ log(e.message,"err"); } };
$("btnUnstake").onclick = async ()=>{ try{ await initContract(); let tx=await contract.unstake("0x...",1); log(`Unstake: ${tx.hash}`);}catch(e){ log(e.message,"err"); } };
$("btnRegister").onclick = async ()=>{ try{ await initContract(); let tx=await contract.registerCollection("0x...",1000); log(`Register: ${tx.hash}`);}catch(e){ log(e.message,"err"); } };

// Bluechip
$("btnEnrollBlue").onclick = async ()=>{ try{ await initContract(); let tx=await contract.enrollBluechip(); log(`Enroll: ${tx.hash}`);}catch(e){ log(e.message,"err"); } };
$("btnHarvestBlue").onclick = async ()=>{ try{ await initContract(); let tx=await contract.harvestBluechip("0x..."); log(`HarvestBlue: ${tx.hash}`);}catch(e){ log(e.message,"err"); } };
$("btnSetBlue").onclick = async ()=>{ try{ await initContract(); let tx=await contract.setBluechipCollection("0x...",true); log(`SetBlue: ${tx.hash}`);}catch(e){ log(e.message,"err"); } };

// Governance
$("btnPropose").onclick = async ()=>{ try{ await initContract(); let tx=await contract.propose(0,0,123,"0x0000000000000000000000000000000000000000"); log(`Propose: ${tx.hash}`);}catch(e){ log(e.message,"err"); } };
$("btnVote").onclick = async ()=>{ try{ await initContract(); let tx=await contract.vote("0x123"); log(`Vote: ${tx.hash}`);}catch(e){ log(e.message,"err"); } };
$("btnExecute").onclick = async ()=>{ try{ await initContract(); let tx=await contract.executeProposal("0x123"); log(`Execute: ${tx.hash}`);}catch(e){ log(e.message,"err"); } };

// Guardians
$("btnPropDep").onclick = async ()=>{ try{ await initContract(); let tx=await contract.proposeDeployerRecovery("0x..."); log(`PropDep: ${tx.hash}`);}catch(e){ log(e.message,"err"); } };
$("btnApproveDep").onclick = async ()=>{ try{ await initContract(); let tx=await contract.approveDeployerRecovery(); log(`ApproveDep: ${tx.hash}`);}catch(e){ log(e.message,"err"); } };
$("btnExecDep").onclick = async ()=>{ try{ await initContract(); let tx=await contract.executeDeployerRecovery(); log(`ExecDep: ${tx.hash}`);}catch(e){ log(e.message,"err"); } };
$("btnPropAdm").onclick = async ()=>{ try{ await initContract(); let tx=await contract.proposeAdminRecovery("0x..."); log(`PropAdm: ${tx.hash}`);}catch(e){ log(e.message,"err"); } };
$("btnApproveAdm").onclick = async ()=>{ try{ await initContract(); let tx=await contract.approveAdminRecovery(); log(`ApproveAdm: ${tx.hash}`);}catch(e){ log(e.message,"err"); } };
$("btnExecAdm").onclick = async ()=>{ try{ await initContract(); let tx=await contract.executeAdminRecovery(); log(`ExecAdm: ${tx.hash}`);}catch(e){ log(e.message,"err"); } };

// Admin
$("btnPause").onclick = async ()=>{ try{ await initContract(); let tx=await contract.pause(); log(`Pause: ${tx.hash}`);}catch(e){ log(e.message,"err"); } };
$("btnUnpause").onclick = async ()=>{ try{ await initContract(); let tx=await contract.unpause(); log(`Unpause: ${tx.hash}`);}catch(e){ log(e.message,"err"); } };
$("btnWithdraw").onclick = async ()=>{ try{ await initContract(); let tx=await contract.withdrawTreasury(user, 1000); log(`Withdraw: ${tx.hash}`);}catch(e){ log(e.message,"err"); } };

// Stats
$("btnRefresh").onclick = async ()=>{ try{ await initContract(); let s=await contract.stakingStats(); $("stats").textContent=JSON.stringify(s,null,2);}catch(e){ log(e.message,"err"); } };

</script>
</body>
</html>
