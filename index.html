<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Catalyst DApp (v1 style, upgraded)</title>
  <style>
    body { font-family: Arial, sans-serif; background:#111; color:#eee; padding:1rem; }
    h1,h2 { color:#0ff; }
    input,button { margin:0.2rem; padding:0.5rem; }
    .section { border:1px solid #333; padding:1rem; margin-bottom:1rem; background:#1a1a1a; }
    .log { background:#000; color:#0f0; padding:1rem; height:150px; overflow-y:auto; font-family:monospace; }
  </style>
</head>
<body>
  <h1>‚ö° Catalyst DApp</h1>
  <button id="connectWallet">üîó Connect Wallet</button>
  <p id="walletAddress">Not connected</p>

  <div class="section">
    <h2>Stake NFTs</h2>
    <input id="stakeCollection" placeholder="Collection Address">
    <input id="stakeTokenId" placeholder="Token ID">
    <label><input type="checkbox" id="stakePermanent"> Permanent</label>
    <button id="stakeBtn">Stake</button>
    <button id="unstakeBtn">Unstake</button>
    <button id="harvestBtn">Harvest</button>
  </div>

  <div class="section">
    <h2>Blue-Chip</h2>
    <button id="enrollBluechip">Enroll</button>
    <input id="bluechipCollection" placeholder="Collection Address">
    <button id="harvestBluechip">Harvest Bluechip</button>
  </div>

  <div class="section">
    <h2>Governance</h2>
    <select id="proposalType">
      <option value="0">Base Reward</option>
      <option value="1">Harvest Fee</option>
      <option value="2">Unstake Fee</option>
      <option value="3">Registration Fee</option>
      <option value="4">Voting Param</option>
      <option value="5">Tier Upgrade</option>
    </select>
    <input id="paramTarget" placeholder="Param Target (uint8)">
    <input id="newValue" placeholder="New Value (uint256)">
    <input id="collectionCtx" placeholder="Collection (optional)">
    <button id="proposeBtn">Propose</button>
    <input id="proposalId" placeholder="Proposal ID">
    <button id="voteBtn">Vote</button>
    <button id="executeBtn">Execute</button>
  </div>

  <div class="section">
    <h2>Guardian Recovery</h2>
    <input id="newDeployer" placeholder="New Deployer">
    <button id="proposeDeployer">Propose Deployer Recovery</button>
    <button id="approveDeployer">Approve Deployer Recovery</button>
    <button id="execDeployer">Execute Deployer Recovery</button>
    <br>
    <input id="newAdmin" placeholder="New Admin">
    <button id="proposeAdmin">Propose Admin Recovery</button>
    <button id="approveAdmin">Approve Admin Recovery</button>
    <button id="execAdmin">Execute Admin Recovery</button>
  </div>

  <div class="section">
    <h2>Admin</h2>
    <button id="pauseBtn">Pause</button>
    <button id="unpauseBtn">Unpause</button>
    <input id="treasuryTo" placeholder="Treasury To">
    <input id="treasuryAmt" placeholder="Amount">
    <button id="withdrawTreasury">Withdraw Treasury</button>
  </div>

  <div class="log" id="log"></div>

  <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>
  <script>
    const CONTRACT_ADDRESS = "0xYourDeployedContract"; // replace with deployed address
    let provider, signer, contract, ABI;

    const logEl = document.getElementById("log");
    function log(msg) {
      logEl.innerHTML += msg + "<br>";
      logEl.scrollTop = logEl.scrollHeight;
    }

    async function loadContract() {
      const res = await fetch("./abi/CatalystNFTStakingUpgradeable.json");
      ABI = await res.json();
      provider = new ethers.providers.Web3Provider(window.ethereum);
      signer = provider.getSigner();
      contract = new ethers.Contract(CONTRACT_ADDRESS, ABI, signer);
      log("‚úÖ ABI loaded and contract ready");
    }

    document.getElementById("connectWallet").onclick = async () => {
      await provider.send("eth_requestAccounts", []);
      const addr = await signer.getAddress();
      document.getElementById("walletAddress").innerText = addr;
      log("üîó Connected: " + addr);
    };

    loadContract();

    // ---- Staking ----
    document.getElementById("stakeBtn").onclick = async () => {
      const coll = document.getElementById("stakeCollection").value;
      const id = document.getElementById("stakeTokenId").value;
      const perm = document.getElementById("stakePermanent").checked;
      await contract.stake(coll, id, perm);
      log(`üì• Staked NFT ${id} from ${coll}`);
    };
    document.getElementById("unstakeBtn").onclick = async () => {
      const coll = document.getElementById("stakeCollection").value;
      const id = document.getElementById("stakeTokenId").value;
      await contract.unstake(coll, id);
      log(`üì§ Unstaked NFT ${id} from ${coll}`);
    };
    document.getElementById("harvestBtn").onclick = async () => {
      const coll = document.getElementById("stakeCollection").value;
      const id = document.getElementById("stakeTokenId").value;
      await contract.harvest(coll, id);
      log(`üí∞ Harvested rewards from ${id}`);
    };

    // ---- Bluechip ----
    document.getElementById("enrollBluechip").onclick = async () => {
      await contract.enrollBluechip();
      log("üîµ Enrolled in Bluechip");
    };
    document.getElementById("harvestBluechip").onclick = async () => {
      const coll = document.getElementById("bluechipCollection").value;
      await contract.harvestBluechip(coll);
      log(`üíé Harvested Bluechip rewards from ${coll}`);
    };

    // ---- Governance ----
    document.getElementById("proposeBtn").onclick = async () => {
      const type = document.getElementById("proposalType").value;
      const target = document.getElementById("paramTarget").value;
      const val = document.getElementById("newValue").value;
      const ctx = document.getElementById("collectionCtx").value || ethers.constants.AddressZero;
      await contract.propose(type, target, val, ctx);
      log("üìú Proposal submitted");
    };
    document.getElementById("voteBtn").onclick = async () => {
      const id = document.getElementById("proposalId").value;
      await contract.vote(id);
      log(`üó≥Ô∏è Voted on ${id}`);
    };
    document.getElementById("executeBtn").onclick = async () => {
      const id = document.getElementById("proposalId").value;
      await contract.executeProposal(id);
      log(`‚úÖ Executed proposal ${id}`);
    };

    // ---- Guardians ----
    document.getElementById("proposeDeployer").onclick = async () => {
      const addr = document.getElementById("newDeployer").value;
      await contract.proposeDeployerRecovery(addr);
      log(`üõ°Ô∏è Proposed deployer recovery to ${addr}`);
    };
    document.getElementById("approveDeployer").onclick = async () => {
      await contract.approveDeployerRecovery();
      log("üëç Approved deployer recovery");
    };
    document.getElementById("execDeployer").onclick = async () => {
      await contract.executeDeployerRecovery();
      log("‚úÖ Executed deployer recovery");
    };
    document.getElementById("proposeAdmin").onclick = async () => {
      const addr = document.getElementById("newAdmin").value;
      await contract.proposeAdminRecovery(addr);
      log(`üõ°Ô∏è Proposed admin recovery to ${addr}`);
    };
    document.getElementById("approveAdmin").onclick = async () => {
      await contract.approveAdminRecovery();
      log("üëç Approved admin recovery");
    };
    document.getElementById("execAdmin").onclick = async () => {
      await contract.executeAdminRecovery();
      log("‚úÖ Executed admin recovery");
    };

    // ---- Admin ----
    document.getElementById("pauseBtn").onclick = async () => {
      await contract.pause();
      log("‚è∏Ô∏è Paused");
    };
    document.getElementById("unpauseBtn").onclick = async () => {
      await contract.unpause();
      log("‚ñ∂Ô∏è Unpaused");
    };
    document.getElementById("withdrawTreasury").onclick = async () => {
      const to = document.getElementById("treasuryTo").value;
      const amt = document.getElementById("treasuryAmt").value;
      await contract.withdrawTreasury(to, amt);
      log(`üè¶ Withdrew ${amt} to ${to}`);
    };
  </script>
</body>
</html>
