<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Catalyst DApp</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/ethers@6.6.0/dist/ethers.umd.min.js"></script>
  <style>
    .tab { display: none; }
    .active-tab { display: block; }
    .btn { background:#2563eb; color:white; padding:6px 12px; border-radius:8px; }
    .mono { font-family: monospace; }
  </style>
</head>
<body class="bg-gray-950 text-gray-100 min-h-screen">
  <div class="max-w-5xl mx-auto p-6">
    <h1 class="text-3xl font-bold mb-6 text-center">Catalyst Staking DApp</h1>

    <!-- Navigation Tabs -->
    <div class="flex gap-3 mb-6">
      <button class="btn" onclick="switchTab('staking')">Staking</button>
      <button class="btn" onclick="switchTab('governance')">Governance</button>
      <button class="btn" onclick="switchTab('bluechip')">Bluechip</button>
      <button class="btn" onclick="switchTab('dashboard')">Dashboard</button>
    </div>

    <!-- =============== STAKING TAB =============== -->
    <div class="tab active-tab" id="tab-staking">
      <h3 class="text-xl font-semibold mb-2">NFT Staking</h3>
      <input id="stakeCollection" placeholder="Collection Address" class="p-2 rounded text-black w-full mb-2">
      <input id="stakeTokenId" placeholder="Token ID" class="p-2 rounded text-black w-full mb-2">
      <button id="btnStake" class="btn">Stake NFT</button>
      <button id="btnUnstake" class="btn">Unstake NFT</button>
      <button id="btnHarvest" class="btn">Harvest Rewards</button>
      <pre id="stakeLog" class="mono mt-3 text-green-400">â€”</pre>
    </div>

    <!-- =============== GOVERNANCE TAB =============== -->
    <div class="tab" id="tab-governance">
      <h3 class="text-xl font-semibold mb-2">Governance</h3>
      <input id="govParam" placeholder="Param Target (0,1,2â€¦)" class="p-2 rounded text-black w-full mb-2">
      <input id="govValue" placeholder="New Value" class="p-2 rounded text-black w-full mb-2">
      <button id="btnPropose" class="btn">Propose</button>
      <input id="voteId" placeholder="Proposal ID" class="p-2 rounded text-black w-full mt-4 mb-2">
      <button id="btnVote" class="btn">Vote</button>
      <button id="btnExecute" class="btn">Execute</button>
      <pre id="govLog" class="mono mt-3 text-purple-400">â€”</pre>
    </div>

    <!-- =============== BLUECHIP TAB =============== -->
    <div class="tab" id="tab-bluechip">
      <h3 class="text-xl font-semibold mb-2">Bluechip Enrollment</h3>
      <button id="btnEnroll" class="btn">Enroll as Bluechip Wallet</button>
      <input id="blueCollection" placeholder="Bluechip Collection Address" class="p-2 rounded text-black w-full mt-4 mb-2">
      <button id="btnHarvestBlue" class="btn">Harvest Bluechip Rewards</button>
      <pre id="blueLog" class="mono mt-3 text-yellow-400">â€”</pre>
    </div>

    <!-- =============== DASHBOARD TAB =============== -->
    <div class="tab" id="tab-dashboard">
      <h3 class="text-xl font-bold mb-4">ðŸ“Š Protocol Dashboard</h3>

      <!-- Protocol Stats -->
      <div class="card p-4 mb-4 bg-gray-900 rounded-2xl shadow">
        <h4 class="font-semibold mb-2">Protocol Stats</h4>
        <button id="btnStats" class="btn">Load Stats</button>
        <pre id="statsView" class="mono text-sm text-green-400">â€”</pre>
      </div>

      <!-- Treasury -->
      <div class="card p-4 mb-4 bg-gray-900 rounded-2xl shadow">
        <h4 class="font-semibold mb-2">Treasury</h4>
        <button id="btnTreasury" class="btn">View Treasury Balance</button>
        <pre id="treasuryView" class="mono text-sm text-blue-400">â€”</pre>
      </div>

      <!-- Collections -->
      <div class="card p-4 mb-4 bg-gray-900 rounded-2xl shadow">
        <h4 class="font-semibold mb-2">Registered Collections</h4>
        <button id="btnCollections" class="btn">View Collections</button>
        <pre id="collectionsView" class="mono text-sm text-yellow-400">â€”</pre>
      </div>

      <!-- Governance Parameters -->
      <div class="card p-4 mb-4 bg-gray-900 rounded-2xl shadow">
        <h4 class="font-semibold mb-2">Governance Parameters</h4>
        <button id="btnGovParams" class="btn">Load Governance Params</button>
        <pre id="govParamsView" class="mono text-sm text-purple-400">â€”</pre>
      </div>

      <!-- Guardians -->
      <div class="card p-4 mb-4 bg-gray-900 rounded-2xl shadow">
        <h4 class="font-semibold mb-2">Guardian Councils</h4>
        <button id="btnGuardians" class="btn">View Guardians</button>
        <pre id="guardiansView" class="mono text-sm text-orange-400">â€”</pre>
      </div>

      <!-- Recovery -->
      <div class="card p-4 mb-4 bg-gray-900 rounded-2xl shadow">
        <h4 class="font-semibold mb-2">Recovery Status</h4>
        <button id="btnRecovery" class="btn">Check Recovery</button>
        <pre id="recoveryView" class="mono text-sm text-red-400">â€”</pre>
      </div>

      <!-- Cooldowns -->
      <div class="card p-4 mb-4 bg-gray-900 rounded-2xl shadow">
        <h4 class="font-semibold mb-2">Cooldowns</h4>
        <button id="btnCooldown" class="btn">View My Cooldown</button>
        <pre id="cooldownView" class="mono text-sm text-cyan-400">â€”</pre>
      </div>

      <!-- Burn Stats -->
      <div class="card p-4 mb-4 bg-gray-900 rounded-2xl shadow">
        <h4 class="font-semibold mb-2">Burn Stats</h4>
        <button id="btnBurnStats" class="btn">View My Burned CATA</button>
        <pre id="burnStatsView" class="mono text-sm text-pink-400">â€”</pre>
      </div>
    </div>
  </div>

  <!-- =============== SCRIPT =============== -->
  <script>
    let provider, signer, walletAddress;
    const CONTRACT_ADDRESS = "YOUR_DEPLOYED_CONTRACT";
    const ABI = []; // paste ABI JSON here

    function $(id){ return document.getElementById(id); }
    function switchTab(tab){ document.querySelectorAll('.tab').forEach(t=>t.classList.remove('active-tab')); $("tab-"+tab).classList.add('active-tab'); }
    function log(msg, target="stakeLog"){ $(target).textContent = msg; }
    function requireWallet(){ if(!walletAddress) throw new Error("Connect wallet first"); }

    let READ_CONTRACT, WRITE_CONTRACT;

    async function connectWallet(){
      provider = new ethers.BrowserProvider(window.ethereum);
      signer = await provider.getSigner();
      walletAddress = await signer.getAddress();
      READ_CONTRACT = new ethers.Contract(CONTRACT_ADDRESS, ABI, provider);
      WRITE_CONTRACT = new ethers.Contract(CONTRACT_ADDRESS, ABI, signer);
      console.log("Wallet connected:", walletAddress);
    }
    connectWallet();

    /* ================== Staking ================== */
    $("btnStake").onclick = async ()=>{
      try{ requireWallet();
        let tx = await WRITE_CONTRACT.stake($("stakeCollection").value,$("stakeTokenId").value,false);
        log("Stake tx sent: "+tx.hash);
      }catch(e){ log(e.message); }
    };
    $("btnUnstake").onclick = async ()=>{
      try{ requireWallet();
        let tx = await WRITE_CONTRACT.unstake($("stakeCollection").value,$("stakeTokenId").value);
        log("Unstake tx sent: "+tx.hash);
      }catch(e){ log(e.message); }
    };
    $("btnHarvest").onclick = async ()=>{
      try{ requireWallet();
        let tx = await WRITE_CONTRACT.harvest($("stakeCollection").value,$("stakeTokenId").value);
        log("Harvest tx sent: "+tx.hash);
      }catch(e){ log(e.message); }
    };

    /* ================== Governance ================== */
    $("btnPropose").onclick = async ()=>{
      try{ requireWallet();
        let tx = await WRITE_CONTRACT.propose(0, $("govParam").value, $("govValue").value, ethers.ZeroAddress);
        log("Propose tx sent: "+tx.hash,"govLog");
      }catch(e){ log(e.message,"govLog"); }
    };
    $("btnVote").onclick = async ()=>{
      try{ requireWallet();
        let tx = await WRITE_CONTRACT.vote($("voteId").value);
        log("Vote tx sent: "+tx.hash,"govLog");
      }catch(e){ log(e.message,"govLog"); }
    };
    $("btnExecute").onclick = async ()=>{
      try{ requireWallet();
        let tx = await WRITE_CONTRACT.executeProposal($("voteId").value);
        log("Execute tx sent: "+tx.hash,"govLog");
      }catch(e){ log(e.message,"govLog"); }
    };

    /* ================== Bluechip ================== */
    $("btnEnroll").onclick = async ()=>{
      try{ requireWallet();
        let tx = await WRITE_CONTRACT.enrollBluechip();
        log("Enroll tx sent: "+tx.hash,"blueLog");
      }catch(e){ log(e.message,"blueLog"); }
    };
    $("btnHarvestBlue").onclick = async ()=>{
      try{ requireWallet();
        let tx = await WRITE_CONTRACT.harvestBluechip($("blueCollection").value);
        log("Harvest Bluechip tx sent: "+tx.hash,"blueLog");
      }catch(e){ log(e.message,"blueLog"); }
    };

    /* ================== Dashboard ================== */
    $("btnStats").onclick = async ()=>{
      try {
        const res = await READ_CONTRACT.stakingStats();
        $("statsView").textContent =
          `Total: ${res[0]}\nTerm: ${res[1]}\nPermanent: ${res[2]}\nRemaining Global: ${res[3]}\nRemaining Term: ${res[4]}\nRemaining Permanent: ${res[5]}`;
      } catch(e){ log(e.message,"statsView"); }
    };
    $("btnTreasury").onclick = async ()=>{
      try {
        const bal = await READ_CONTRACT.treasuryBalance();
        $("treasuryView").textContent = `Treasury Balance: ${ethers.formatUnits(bal,18)} CATA`;
      } catch(e){ log(e.message,"treasuryView"); }
    };
    $("btnCollections").onclick = async ()=>{
      try {
        const count = await READ_CONTRACT.collectionCount();
        let txt = `Total Collections: ${count}\n`;
        for (let i=0;i<count;i++){
          let addr = await READ_CONTRACT.registeredCollections(i);
          txt += ` #${i}: ${addr}\n`;
        }
        $("collectionsView").textContent = txt;
      } catch(e){ log(e.message,"collectionsView"); }
    };
    $("btnGovParams").onclick = async ()=>{
      try {
        const minStakeAge = await READ_CONTRACT.minStakeAgeForVoting();
        const maxBase = await READ_CONTRACT.maxBaseRewardRate();
        const fee = await READ_CONTRACT.collectionRegistrationFee();
        const harvestFee = await READ_CONTRACT.initialHarvestBurnFeeRate();
        const unstakeFee = await READ_CONTRACT.unstakeBurnFee();
        $("govParamsView").textContent =
          `Min Stake Age: ${minStakeAge}\nMax Base Reward Rate: ${maxBase}\nRegistration Fee: ${ethers.formatUnits(fee,18)} CATA\nHarvest Burn Fee: ${harvestFee}%\nUnstake Fee: ${ethers.formatUnits(unstakeFee,18)} CATA`;
      } catch(e){ log(e.message,"govParamsView"); }
    };
    $("btnGuardians").onclick = async ()=>{
      try {
        let txt = "Deployer Guardians:\n";
        for (let i=0;i<7;i++){
          try{ txt += ` [${i}] ${await READ_CONTRACT.deployerGuardians(i)}\n`; }catch{}
        }
        txt += "\nAdmin Guardians:\n";
        for (let j=0;j<7;j++){
          try{ txt += ` [${j}] ${await READ_CONTRACT.adminGuardians(j)}\n`; }catch{}
        }
        $("guardiansView").textContent = txt;
      } catch(e){ log(e.message,"guardiansView"); }
    };
    $("btnRecovery").onclick = async ()=>{
      try {
        const dep = await READ_CONTRACT.deployerRecovery();
        const adm = await READ_CONTRACT.adminRecovery();
        $("recoveryView").textContent =
          `Deployer Recovery:\n Proposed: ${dep.proposed}\n Approvals: ${dep.approvals}\n Deadline: ${dep.deadline}\n Executed: ${dep.executed}\n\n` +
          `Admin Recovery:\n Proposed: ${adm.proposed}\n Approvals: ${adm.approvals}\n Deadline: ${adm.deadline}\n Executed: ${adm.executed}`;
      } catch(e){ log(e.message,"recoveryView"); }
    };
    $("btnCooldown").onclick = async ()=>{
      try {
        requireWallet();
        const cd = await READ_CONTRACT.stakingCooldownBlocks();
        const last = await READ_CONTRACT.lastStakingBlock(walletAddress);
        $("cooldownView").textContent =
          `Cooldown: ${cd} blocks\nLast Stake Block: ${last}\nCurrent Block: ${await provider.getBlockNumber()}`;
      } catch(e){ log(e.message,"cooldownView"); }
    };
    $("btnBurnStats").onclick = async ()=>{
      try {
        requireWallet();
        const burned = await READ_CONTRACT.burnedCatalystByAddress(walletAddress);
        $("burnStatsView").textContent = `You have burned: ${ethers.formatUnits(burned,18)} CATA`;
      } catch(e){ log(e.message,"burnStatsView"); }
    };
  </script>
</body>
</html>
