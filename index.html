<!doctype html>

<html lang="en">  
<head>  
  <meta charset="utf-8" />  
  <meta name="viewport" content="width=device-width,initial-scale=1" />  
  <title>Catalyst Protocol — DApp (Production-ready UI)</title>  
  <meta name="description" content="Catalyst Protocol dApp — staking, governance, council" />  
  <!-- Tailwind CDN -->  
  <script src="https://cdn.tailwindcss.com"></script>  
  <style>  
    /* Small polished tweaks */  
    body { background: linear-gradient(180deg,#041024 0%, #061426 100%); }  
    .glass { background: rgba(255,255,255,0.03); backdrop-filter: blur(6px); }  
  </style>  
</head>  
<body class="min-h-screen text-white font-sans">  
  <div class="max-w-6xl mx-auto p-6">  
    <header class="flex items-center justify-between mb-6">  
      <div>  
        <h1 class="text-2xl font-bold">Catalyst Protocol</h1>  
        <p class="text-sm text-slate-300">Staking · Governance · Guardian Council</p>  
      </div>  
      <div class="flex items-center gap-3">  
        <div id="networkBadge" class="px-3 py-1 rounded-md text-sm glass">Network: <span id="networkName">—</span></div>  
        <button id="connectBtn" class="px-4 py-2 bg-gradient-to-r from-green-500 to-cyan-400 rounded-md font-semibold text-black">Connect</button>  
        <button id="disconnectBtn" class="px-4 py-2 bg-red-500 rounded-md font-semibold hidden">Disconnect</button>  
      </div>  
    </header>  

<main class="grid grid-cols-1 md:grid-cols-3 gap-6">  
  <!-- Left: Quick Status -->  
  <section class="glass p-4 rounded-lg">  
    <h2 class="font-semibold mb-2">Quick Status</h2>  
    <div class="space-y-2 text-sm text-slate-200">  
      <div>Connected: <strong id="addr">Not connected</strong></div>  
      <div>CATA Balance: <strong id="cataBal">—</strong></div>  
      <div>Staked NFTs (global): <strong id="globalStaked">—</strong></div>  
      <div>Roles (CATA / Staking): <small id="roles">—</small></div>  
    </div>  
    <hr class="my-3 border-slate-700" />  
    <div class="text-xs text-slate-300">Contract Addresses (fill & Save)</div>  
    <div class="mt-2 space-y-2">  
      <input id="addrCata" placeholder="CATA Token Address" class="w-full p-2 rounded bg-black/20 text-sm" />  
      <input id="addrStaking" placeholder="Staking Contract Address" class="w-full p-2 rounded bg-black/20 text-sm" />  
      <input id="addrGovernance" placeholder="Governance Contract Address" class="w-full p-2 rounded bg-black/20 text-sm" />  
      <input id="addrCouncil" placeholder="GuardianCouncil Address" class="w-full p-2 rounded bg-black/20 text-sm" />  
      <div class="flex gap-2">  
        <button id="saveAddrs" class="px-3 py-1 bg-slate-700 rounded text-sm">Save</button>  
        <button id="loadAddrs" class="px-3 py-1 bg-slate-700/50 rounded text-sm">Load from local</button>  
      </div>  
    </div>  
  </section>  

  <!-- Middle: Staking Actions -->  
  <section class="glass p-4 rounded-lg">  
    <h2 class="font-semibold mb-2">Staking</h2>  
    <p class="text-sm text-slate-300 mb-3">Approve NFT → Term Stake or Permanent Stake → Harvest / Unstake</p>  
    <div class="space-y-2 text-sm">  
      <div class="grid grid-cols-2 gap-2">  
        <input id="nftCollection" placeholder="NFT Collection Address" class="p-2 rounded bg-black/20" />  
        <input id="nftTokenId" placeholder="Token ID" class="p-2 rounded bg-black/20" />  
      </div>  
      <div class="flex gap-2">  
        <button id="approveNFT" class="flex-1 p-2 bg-yellow-500 text-black rounded">Approve Staking Contract</button>  
        <button id="termStakeBtn" class="flex-1 p-2 bg-indigo-600 rounded">Term Stake</button>  
      </div>  
      <div class="flex gap-2">  
        <button id="permApproveFee" class="flex-1 p-2 bg-amber-600 rounded">Approve Fee (CATA)</button>  
        <button id="permStakeBtn" class="flex-1 p-2 bg-emerald-600 text-black rounded">Permanent Stake</button>  
      </div>  
      <div class="flex gap-2">  
        <button id="harvestBtn" class="flex-1 p-2 bg-sky-600 rounded">Harvest</button>  
        <button id="unstakeBtn" class="flex-1 p-2 bg-red-600 rounded">Unstake</button>  
      </div>  
    </div>  

    <!-- ✅ Advanced Batch Section -->  
    <div class="mt-4 p-3 border border-slate-700 rounded">  
      <h3 class="font-semibold mb-2">Advanced Batch Staking</h3>  
      <textarea id="batchCollections" rows="2" placeholder="Comma-separated NFT collection addresses" class="w-full p-2 rounded bg-black/20 text-sm"></textarea>  
      <textarea id="batchTokenIds" rows="2" placeholder="Comma-separated token IDs" class="w-full p-2 rounded bg-black/20 text-sm"></textarea>  
      <div class="flex gap-2 mt-2">  
        <button id="batchTermStakeBtn" class="flex-1 p-2 bg-indigo-700 rounded">Batch Term Stake</button>  
        <button id="batchPermStakeBtn" class="flex-1 p-2 bg-green-700 rounded">Batch Perm Stake</button>  
      </div>  
      <div class="flex gap-2 mt-2">  
        <button id="batchUnstakeBtn" class="flex-1 p-2 bg-red-700 rounded">Batch Unstake</button>  
      </div>  
    </div>  
  </section>  

  <!-- Right: Governance & Council (unchanged UI) -->  
  <section class="glass p-4 rounded-lg">  
    <h2 class="font-semibold mb-2">Governance & Council</h2>  
    ... (your governance/council code remains unchanged) ...  
  </section>  
</main>  

<section class="glass p-4 rounded-lg mt-6">  
  <h3 class="font-semibold mb-2">Advanced / Logs</h3>  
  <div id="logs" class="h-48 overflow-auto text-xs font-mono bg-black/20 p-3 rounded"></div>  
</section>  

<footer class="mt-6 text-xs text-slate-500">© Catalyst Protocol — Use at your own risk.</footer>  
</div>  

<!-- Ethers.js -->  
<script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.min.js"></script>  
<script>  
// ✅ ABI URLs for your 4 project contracts  
const ABI_URLS = {  
  cata: 'abi/cata.json',  
  staking: 'abi/staking.json',  
  governance: 'abi/governance.json',  
  council: 'abi/council.json'  
};  

// Hardcoded ERC721 ABI (standard minimal)  
const ERC721_ABI = [  
  'function approve(address to, uint256 tokenId)',  
  'function setApprovalForAll(address operator, bool approved)',  
  'function isApprovedForAll(address owner, address operator) view returns (bool)'  
];  

async function loadABI(name) {  
  try {  
    const res = await fetch(ABI_URLS[name]);  
    return await res.json();  
  } catch (e) {  
    log('ABI load error', name, e);  
    return [];  
  }  
}  

let provider, signer, userAddr;  
let contracts = { cata: null, staking: null, governance: null, council: null };  

const $ = id => document.getElementById(id);  
function log(...args) {  
  console.log(...args);  
  $('logs').innerText = new Date().toISOString() + ' • ' + args.join(' ') + '\n' + $('logs').innerText;  
}  

// ✅ Connect / Disconnect  
async function connect() {  
  if (!window.ethereum) return alert('No Web3 wallet detected');  
  try {  
    provider = new ethers.providers.Web3Provider(window.ethereum);  
    await provider.send('eth_requestAccounts', []);  
    signer = provider.getSigner();  
    userAddr = await signer.getAddress();  
    $('addr').innerText = userAddr;  
    $('connectBtn').classList.add('hidden');  
    $('disconnectBtn').classList.remove('hidden');  
    log('Connected', userAddr);  
  } catch(e) { log('connect err', e.message); }  
}  

function disconnect() {  
  provider = null; signer = null; userAddr = null;  
  $('addr').innerText = 'Not connected';  
  $('connectBtn').classList.remove('hidden');  
  $('disconnectBtn').classList.add('hidden');  
  log('Disconnected');  
}  

// ✅ Batch handlers  
async function batchTermStake() {  
  const cols = $('batchCollections').value.split(',').map(x=>x.trim());  
  const ids = $('batchTokenIds').value.split(',').map(x=>x.trim());  
  const tx = await contracts.staking.batchTermStake(cols, ids);  
  log('batchTermStake', tx.hash);  
  await tx.wait();  
  log('Batch Term Stake complete');  
}  

async function batchPermStake() {  
  const cols = $('batchCollections').value.split(',').map(x=>x.trim());  
  const ids = $('batchTokenIds').value.split(',').map(x=>x.trim());  
  const tx = await contracts.staking.batchPermanentStake(cols, ids);  
  log('batchPermStake', tx.hash);  
  await tx.wait();  
  log('Batch Perm Stake complete');  
}  

async function batchUnstake() {  
  const cols = $('batchCollections').value.split(',').map(x=>x.trim());  
  const ids = $('batchTokenIds').value.split(',').map(x=>x.trim());  
  const tx = await contracts.staking.batchUnstake(cols, ids);  
  log('batchUnstake', tx.hash);  
  await tx.wait();  
  log('Batch Unstake complete');  
}  

// ✅ Bind buttons  
window.addEventListener('load', ()=>{  
  $('connectBtn').onclick = connect;  
  $('disconnectBtn').onclick = disconnect;  
  $('batchTermStakeBtn').onclick = batchTermStake;  
  $('batchPermStakeBtn').onclick = batchPermStake;  
  $('batchUnstakeBtn').onclick = batchUnstake;  
});  
</script>  
</body>  
</html>
