<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Catalyst Protocol DApp</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/ethers@6.6.2/dist/ethers.min.js"></script>
  <style>
    .tab { display: none; }
    .tab.active { display: block; }
    .btn { background:#2563eb; color:white; padding:6px 12px; border-radius:8px; margin:2px; }
    .mono { font-family: monospace; }
  </style>
</head>
<body class="bg-gray-950 text-gray-100 min-h-screen">
  <div class="max-w-6xl mx-auto p-6">
    <h1 class="text-3xl font-bold mb-6 text-center">üåê Catalyst Protocol DApp</h1>

    <!-- Nav -->
    <div class="flex flex-wrap gap-2 mb-6 justify-center">
      <button class="btn tab-btn" data-tab="dashboard">Dashboard</button>
      <button class="btn tab-btn" data-tab="staking">Staking</button>
      <button class="btn tab-btn" data-tab="bluechip">Blue-chip</button>
      <button class="btn tab-btn" data-tab="governance">Governance</button>
      <button class="btn tab-btn" data-tab="guardians">Guardians</button>
      <button class="btn tab-btn" data-tab="admin">Admin</button>
    </div>

    <!-- =============== DASHBOARD =============== -->
    <div id="dashboard" class="tab active">
      <h2 class="text-2xl font-semibold mb-4">üìä Dashboard</h2>
      <div class="grid gap-4 md:grid-cols-2">
        <div class="p-4 bg-gray-900 rounded-2xl shadow">
          <h3 class="font-semibold mb-2">Protocol Stats</h3>
          <pre id="statsView" class="mono text-sm text-green-400">Loading...</pre>
        </div>
        <div class="p-4 bg-gray-900 rounded-2xl shadow">
          <h3 class="font-semibold mb-2">Treasury</h3>
          <pre id="treasuryView" class="mono text-sm text-blue-400">Loading...</pre>
        </div>
        <div class="p-4 bg-gray-900 rounded-2xl shadow">
          <h3 class="font-semibold mb-2">Registered Collections</h3>
          <pre id="collectionsView" class="mono text-sm text-yellow-400">Loading...</pre>
        </div>
        <div class="p-4 bg-gray-900 rounded-2xl shadow">
          <h3 class="font-semibold mb-2">Governance Parameters</h3>
          <pre id="govParamsView" class="mono text-sm text-purple-400">Loading...</pre>
        </div>
        <div class="p-4 bg-gray-900 rounded-2xl shadow">
          <h3 class="font-semibold mb-2">Guardian Councils</h3>
          <pre id="guardiansView" class="mono text-sm text-orange-400">Loading...</pre>
        </div>
        <div class="p-4 bg-gray-900 rounded-2xl shadow">
          <h3 class="font-semibold mb-2">Recovery Status</h3>
          <pre id="recoveryView" class="mono text-sm text-red-400">Loading...</pre>
        </div>
        <div class="p-4 bg-gray-900 rounded-2xl shadow">
          <h3 class="font-semibold mb-2">Cooldowns</h3>
          <pre id="cooldownView" class="mono text-sm text-cyan-400">Loading...</pre>
        </div>
        <div class="p-4 bg-gray-900 rounded-2xl shadow">
          <h3 class="font-semibold mb-2">Burn Stats</h3>
          <pre id="burnStatsView" class="mono text-sm text-pink-400">Loading...</pre>
        </div>
      </div>
    </div>

    <!-- =============== STAKING =============== -->
    <div id="staking" class="tab">
      <h2 class="text-2xl font-semibold mb-4">üîí NFT Staking</h2>
      <input id="stakeCollection" placeholder="Collection Address" class="p-2 rounded text-black w-full mb-2">
      <input id="stakeTokenId" placeholder="Token ID" class="p-2 rounded text-black w-full mb-2">
      <button id="btnStake" class="btn">Stake NFT</button>
      <button id="btnUnstake" class="btn">Unstake NFT</button>
      <button id="btnHarvest" class="btn">Harvest</button>
      <button id="btnPending" class="btn">View Pending Rewards</button>

      <h3 class="mt-6 text-xl font-semibold">Batch Stake</h3>
      <input id="colBatchStake" placeholder="Collection address" class="p-2 rounded text-black w-full mb-2">
      <input id="tidsBatchStake" placeholder="Token IDs (comma separated)" class="p-2 rounded text-black w-full mb-2">
      <button id="btnBatchStake" class="btn">Batch Stake</button>

      <h3 class="mt-6 text-xl font-semibold">Register Collection</h3>
      <input id="colRegister" placeholder="Collection address" class="p-2 rounded text-black w-full mb-2">
      <input id="colSupply" placeholder="Declared Supply" class="p-2 rounded text-black w-full mb-2">
      <button id="btnRegisterCollection" class="btn">Register Collection</button>

      <pre id="stakeLog" class="mono mt-3 text-green-400">‚Äî</pre>
    </div>

    <!-- (Bluechip, Governance, Guardians, Admin remain unchanged from your version) -->

  </div>

  <script>
    /* Navigation */
    document.querySelectorAll('.tab-btn').forEach(btn=>{
      btn.addEventListener('click', ()=>{
        document.querySelectorAll('.tab').forEach(t=>t.classList.remove('active'));
        document.getElementById(btn.dataset.tab).classList.add('active');
      });
    });

    /* Ethers.js */
    let provider, signer, walletAddress, CONTRACT, CONTRACT_ADDRESS, ABI;
    async function init() {
      provider = new ethers.BrowserProvider(window.ethereum);
      signer = await provider.getSigner();
      walletAddress = await signer.getAddress();
      const res = await fetch("abi/CatalystNFTStakingUpgradeable.json");
      ABI = await res.json();
      CONTRACT_ADDRESS = "YOUR_DEPLOYED_CONTRACT";
      CONTRACT = new ethers.Contract(CONTRACT_ADDRESS, ABI, signer);
      console.log("Wallet:", walletAddress);
      refreshDashboard();
      setInterval(refreshDashboard, 30000); // auto-refresh every 30s
    }

    async function refreshDashboard(){
      try {
        const stats = await CONTRACT.stakingStats();
        document.getElementById("statsView").textContent =
          `Total: ${stats[0]}\nTerm: ${stats[1]}\nPermanent: ${stats[2]}`;

        const bal = await CONTRACT.treasuryBalance();
        document.getElementById("treasuryView").textContent =
          `${ethers.formatUnits(bal,18)} CATA`;

        const count = await CONTRACT.collectionCount();
        let txt = `Total Collections: ${count}\n`;
        for (let i=0;i<count;i++){
          let addr = await CONTRACT.registeredCollections(i);
          txt += `#${i}: ${addr}\n`;
        }
        document.getElementById("collectionsView").textContent = txt;

        const minStakeAge = await CONTRACT.minStakeAgeForVoting();
        const maxBase = await CONTRACT.maxBaseRewardRate();
        document.getElementById("govParamsView").textContent =
          `Min Stake Age: ${minStakeAge}\nMax Base Reward: ${maxBase}`;

        let guardianTxt = "";
        for(let i=0;i<3;i++){ try{guardianTxt+=`Deployer[${i}]: ${await CONTRACT.deployerGuardians(i)}\n`;}catch{} }
        for(let i=0;i<3;i++){ try{guardianTxt+=`Admin[${i}]: ${await CONTRACT.adminGuardians(i)}\n`;}catch{} }
        document.getElementById("guardiansView").textContent = guardianTxt;

        const burned = await CONTRACT.burnedCatalystByAddress(walletAddress);
        document.getElementById("burnStatsView").textContent =
          `${ethers.formatUnits(burned,18)} CATA burned`;

      } catch(e){ console.error("Dashboard refresh error",e); }
    }

    window.onload = init;
  </script>
</body>
</html>
